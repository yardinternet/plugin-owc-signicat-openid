(()=>{"use strict";var t={n:e=>{var n=e&&e.__esModule?()=>e.default:()=>e;return t.d(n,{a:n}),n},d:(e,n)=>{for(var i in n)t.o(n,i)&&!t.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:n[i]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)};const e=window.wp.apiFetch;var n=t.n(e);function i(t){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i(t)}function o(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,r(i.key),i)}}function s(t,e,n){return(e=r(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function r(t){var e=function(t,e){if("object"!==i(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var o=n.call(t,"string");if("object"!==i(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===i(e)?e:String(e)}new(function(){function t(e){var i=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),s(this,"checkSessionStatus",(function(){var t=(new Date).valueOf()-i.lastActivity;t>i.modalShouldOpen&&!i.modalIsOpen&&i.toggleModal(!0),t>i.sessionShouldEnd&&i.logout()})),s(this,"updateLastActivity",(function(){i.lastActivity=Date.now(),i.lastActivityIsUpdated=!0})),s(this,"logout",(function(){n()({path:"owc-signicat-openid/v1/revoke"}).then((function(t){console.log(t),window.location=i.logoutUrl}))})),s(this,"keepSessionAlive",(function(){i.lastActivityIsUpdated&&n()({path:"owc-signicat-openid/v1/refresh"}).then((function(t){i.lastActivityIsUpdated=!1}))})),s(this,"a11yClick",(function(t){return"click"===t.type&&"keypress"===t.type&&("keypress"!==t.type||32===(t.charCode||t.keyCode))})),this.second=1e3,this.minute=60*this.second,this.sessionShouldEnd=e.sessionTTL*this.minute,this.modalShouldOpen=this.sessionShouldEnd-this.minute,this.refreshUrl=e.refreshUrl,this.logoutUrl=e.logoutUrl}var e,i;return e=t,(i=[{key:"init",value:function(){this.modalOpenClass="show",this.modalIsOpen=!1,this.lastActivity=new Date,this.lastActivityIsUpdated=!1,this.modalEl=document.getElementById("owc-signicat-openid-modal-wrapper"),this.refreshButtonEl=document.getElementById("owc-signicat-openid-refresh"),this.logoutButtonEl=document.getElementById("owc-signicat-openid-logout"),this.modalEl&&this.logoutButtonEl&&this.refreshButtonEl&&(this.registerEventHandlers(),this.initTimer())}},{key:"registerEventHandlers",value:function(){var t=this;this.refreshButtonEl.addEventListener("click",(function(e){return t.sessionResume(e)})),this.refreshButtonEl.addEventListener("keydown",(function(e){return t.a11yClick(e)})),this.logoutButtonEl.addEventListener("click",(function(e){return t.sessionEnd(e)})),this.logoutButtonEl.addEventListener("keydown",(function(e){return t.a11yClick(e)})),document.addEventListener("mousemove",(function(){return t.updateLastActivity()})),document.addEventListener("keydown",(function(){return t.updateLastActivity()}))}},{key:"initTimer",value:function(){setInterval(this.checkSessionStatus,this.second),setInterval(this.keepSessionAlive,this.minute)}},{key:"sessionResume",value:function(){this.toggleModal(!1),this.keepSessionAlive()}},{key:"sessionEnd",value:function(){this.toggleModal(!1),this.logout()}},{key:"toggleModal",value:function(t){t?(this.modalEl.classList.add(this.modalOpenClass),this.modalEl.setAttribute("aria-hidden","false")):(this.modalEl.classList.remove(this.modalOpenClass),this.modalEl.setAttribute("aria-hidden","truez")),this.modalIsOpen=t}}])&&o(e.prototype,i),Object.defineProperty(e,"prototype",{writable:!1}),t}())(owcSignicatOIDCModalSettings).init()})();